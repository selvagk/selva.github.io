'use strict';(function(C,y){"object"===typeof exports&&"undefined"!==typeof module?y(exports,require("three"),require("troika-worker-utils"),require("troika-three-utils"),require("troika-3d")):"function"===typeof define&&define.amd?define(["exports","three","troika-worker-utils","troika-three-utils","troika-3d"],y):(C=C||self,y(C.troika_3d_text={},C.THREE,C.troika_worker_utils,C.troika_three_utils,C.troika_3d))})(this,function(C,y,I,fa,G){function ha(k,f){k=T({},k);U.href=k.font||L.defaultFontURL;
k.font=U.href;k.text=""+k.text;var b=L.sdfGlyphSize,a=L.textureWidth,c=V[k.font];c||(c=V[k.font]={sdfTexture:new y.DataTexture(new Uint8Array(b*a),a,b,y.LuminanceFormat,void 0,void 0,void 0,void 0,y.LinearFilter,y.LinearFilter)},c.sdfTexture.font=k.font);ia(k).then(function(a){a.newGlyphSDFs&&(a.newGlyphSDFs.forEach(function(a){var d=a.textureData;a=a.atlasIndex;for(var e=c.sdfTexture.image;e.data.length<(a+1)*b*b;){var f=new Uint8Array(2*e.data.length);f.set(e.data);e.data=f;e.height*=2}f=e.width/
b;for(var n=0;n<b;n++)for(var w=n*b,t=e.width*b*Math.floor(a/f)+a%f*b+n*e.width,m=0;m<b;m++)e.data[t+m]=d[w+m]}),c.sdfTexture.needsUpdate=!0);f(Object.freeze({sdfTexture:c.sdfTexture,sdfGlyphSize:b,sdfMinDistancePercent:.125,glyphBounds:a.glyphBounds,glyphAtlasIndices:a.glyphAtlasIndices,caretPositions:a.caretPositions,caretHeight:a.caretHeight,totalBounds:a.totalBounds,totalBlockSize:a.totalBlockSize}))})}function T(k,f){for(var b in f)f.hasOwnProperty(b)&&(k[b]=f[b]);return k}function W(k,f,b,a){var c=
k.getAttribute(f);c&&c.array.length===b.length?(c.array.set(b),c.needsUpdate=!0):k.setAttribute(f,new y.InstancedBufferAttribute(b,a))}function ja(k){k=fa.createDerivedMaterial(k,{extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new y.Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFMinDistancePct:{value:0},uTroikaTotalBounds:{value:new y.Vector4},uTroikaClipRect:{value:new y.Vector4},uTroikaSDFDebug:{value:!1}},vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nvarying vec2 vTroikaSDFTextureUV;\nvarying vec2 vTroikaGlyphUV;\nvarying vec3 vTroikaLocalPos;\n",
vertexTransform:"\nvTroikaGlyphUV = vec2(position);\n\nvec2 colsAndRows = uTroikaSDFTextureSize / uTroikaSDFGlyphSize;\nvTroikaSDFTextureUV = vec2(\n  mod(aTroikaGlyphIndex, colsAndRows.x) + position.x,\n  floor(aTroikaGlyphIndex / colsAndRows.x) + position.y\n) * uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\n\nposition = vec3(\n  mix(aTroikaGlyphBounds.x, aTroikaGlyphBounds.z, position.x),\n  mix(aTroikaGlyphBounds.y, aTroikaGlyphBounds.w, position.y),\n  position.z\n);\nvTroikaLocalPos = vec3(position);\n\nuv = vec2(\n  (position.x - uTroikaTotalBounds.x) / (uTroikaTotalBounds.z - uTroikaTotalBounds.x),\n  (position.y - uTroikaTotalBounds.y) / (uTroikaTotalBounds.w - uTroikaTotalBounds.y)\n);\n",
fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform float uTroikaSDFMinDistancePct;\nuniform bool uTroikaSDFDebug;\nuniform vec4 uTroikaClipRect;\nvarying vec2 vTroikaSDFTextureUV;\nvarying vec2 vTroikaGlyphUV;\nvarying vec3 vTroikaLocalPos;\n\nfloat troikaGetClipAlpha() {\n  vec4 clip = uTroikaClipRect;\n  vec3 pos = vTroikaLocalPos;\n  float dClip = min(\n    min(pos.x - min(clip.x, clip.z), max(clip.x, clip.z) - pos.x),\n    min(pos.y - min(clip.y, clip.w), max(clip.y, clip.w) - pos.y)\n  );\n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  float aa = length(fwidth(pos)) * 0.5;\n  return smoothstep(-aa, aa, dClip);\n  #else\n  return step(0.0, dClip);\n  #endif\n}\n\nfloat troikaGetTextAlpha() {\n  float troikaSDFValue = texture2D(uTroikaSDFTexture, vTroikaSDFTextureUV).r;\n  \n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(0.5, troikaSDFValue);\n  #else\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  float aaDist = min(\n    0.5,\n    0.5 * min(\n      fwidth(vTroikaGlyphUV.x),\n      fwidth(vTroikaGlyphUV.y)\n    )\n  ) / uTroikaSDFMinDistancePct;\n  #else\n  float aaDist = 0.01;\n  #endif\n  \n  float alpha = uTroikaSDFDebug ? troikaSDFValue : smoothstep(\n    0.5 - aaDist,\n    0.5 + aaDist,\n    troikaSDFValue\n  );\n  #endif\n  \n  return min(alpha, troikaGetClipAlpha());\n}\n",
fragmentColorTransform:"\nfloat troikaAlphaMult = troikaGetTextAlpha();\nif (troikaAlphaMult == 0.0) {\n  discard;\n} else {\n  gl_FragColor.a *= troikaAlphaMult;\n}\n"});k.transparent=!0;Object.defineProperty(k,"shadowSide",{get:function(){return this.side}});return k}function X(k,f,b){var a=null,c=k.caretHeight;k=ka(k);var d=Infinity;k.forEach(function(a,g){Math.abs(b-(g+c/2))<Math.abs(b-(d+c/2))&&(d=g)});k.get(d).forEach(function(b){if(!a||Math.abs(f-b.x)<Math.abs(f-a.x))a=b});return a}function la(k,
f,b){if(k){var a=Y.get(k);if(a&&a.start===f&&a.end===b)return a.rects;a=k.caretPositions;var c=k.caretHeight,d=k.totalBounds;if(b<f){var e=f;f=b;b=e}f=Math.max(f,0);b=Math.min(b,a.length+1);e=new Map;for(var g=f;g<b;g++){var h=a[3*g],l=a[3*g+1],n=a[3*g+2],w=e.get(n);w?(w.left=Math.max(Math.min(w.left,h),d[0]),w.right=Math.min(Math.max(w.right,l),d[2])):(w={left:h,right:l,bottom:n,top:n+c},e.set(n,w))}var t=[];e.forEach(function(a){t.push(a)});Y.set(k,{start:f,end:b,rects:t})}return t}function ka(k){var f=
Z.get(k);if(!f){var b=k.caretPositions,a=k.caretHeight;f=new Map;for(var c=0;c<b.length;c+=3){var d=b[c+2],e=f.get(d);e||f.set(d,e=[]);e.push({x:b[c],y:d,height:a,charIndex:c/3});c+3>=b.length&&e.push({x:b[c+1],y:d,height:a,charIndex:c/3+1})}}Z.set(k,f);return f}function aa(){var k=(new y.BoxBufferGeometry).translate(0,0,-.5);aa=function(){return k};return k}function ba(){var k=G.createDerivedMaterial(new y.MeshBasicMaterial({transparent:!0,opacity:.3,depthWrite:!1}),{uniforms:{rect:{value:new y.Vector4}},
vertexDefs:"uniform vec4 rect;",vertexTransform:"\n  position.x = position.x < 0.0 ? rect.x : rect.z;\n  position.y = position.y < 0.0 ? rect.w : rect.y;\n  "});ba=function(){return k};return k}var M=I.defineWorkerModule({dependencies:[function(){var k=self,f={parse:function(b){var a=f._bin;b=new Uint8Array(b);if("ttcf"==a.readASCII(b,0,4)){var c=4;a.readUshort(b,c);c+=2;a.readUshort(b,c);c+=2;var d=a.readUint(b,c);c+=4;for(var e=[],g=0;g<d;g++){var h=a.readUint(b,c);c+=4;e.push(f._readFont(b,h))}return e}return[f._readFont(b,
0)]},_readFont:function(b,a){var c=f._bin,d=a;c.readFixed(b,a);a+=4;var e=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;var g="cmap;head;hhea;maxp;hmtx;name;OS/2;post;loca;glyf;kern;CFF ;GPOS;GSUB;SVG ".split(";");d={_data:b,_offset:d};for(var h={},l=0;l<e;l++){var n=c.readASCII(b,a,4);a+=4;c.readUint(b,a);a+=4;var w=c.readUint(b,a);a+=4;var t=c.readUint(b,a);a+=4;h[n]={offset:w,length:t}}for(l=0;l<g.length;l++)a=g[l],h[a]&&(d[a.trim()]=f[a.trim()].parse(b,
h[a].offset,h[a].length,d));return d},_tabOffset:function(b,a,c){var d=f._bin,e=d.readUshort(b,c+4);c+=12;for(var g=0;g<e;g++){var h=d.readASCII(b,c,4);c+=4;d.readUint(b,c);c+=4;var l=d.readUint(b,c);c+=4;d.readUint(b,c);c+=4;if(h==a)return l}return 0}};f._bin={readFixed:function(b,a){return(b[a]<<8|b[a+1])+(b[a+2]<<8|b[a+3])/65540},readF2dot14:function(b,a){return f._bin.readShort(b,a)/16384},readInt:function(b,a){var c=f._bin.t.uint8;c[0]=b[a+3];c[1]=b[a+2];c[2]=b[a+1];c[3]=b[a];return f._bin.t.int32[0]},
readInt8:function(b,a){f._bin.t.uint8[0]=b[a];return f._bin.t.int8[0]},readShort:function(b,a){var c=f._bin.t.uint8;c[1]=b[a];c[0]=b[a+1];return f._bin.t.int16[0]},readUshort:function(b,a){return b[a]<<8|b[a+1]},readUshorts:function(b,a,c){for(var d=[],e=0;e<c;e++)d.push(f._bin.readUshort(b,a+2*e));return d},readUint:function(b,a){var c=f._bin.t.uint8;c[3]=b[a];c[2]=b[a+1];c[1]=b[a+2];c[0]=b[a+3];return f._bin.t.uint32[0]},readUint64:function(b,a){return 4294967296*f._bin.readUint(b,a)+f._bin.readUint(b,
a+4)},readASCII:function(b,a,c){for(var d="",e=0;e<c;e++)d+=String.fromCharCode(b[a+e]);return d},readUnicode:function(b,a,c){for(var d="",e=0;e<c;e++){var g=b[a++]<<8|b[a++];d+=String.fromCharCode(g)}return d},_tdec:k.TextDecoder?new k.TextDecoder:null,readUTF8:function(b,a,c){var d=f._bin._tdec;return d&&0==a&&c==b.length?d.decode(b):f._bin.readASCII(b,a,c)},readBytes:function(b,a,c){for(var d=[],e=0;e<c;e++)d.push(b[a+e]);return d},readASCIIArray:function(b,a,c){for(var d=[],e=0;e<c;e++)d.push(String.fromCharCode(b[a+
e]));return d}};f._bin.t={buff:new ArrayBuffer(8)};f._bin.t.int8=new Int8Array(f._bin.t.buff);f._bin.t.uint8=new Uint8Array(f._bin.t.buff);f._bin.t.int16=new Int16Array(f._bin.t.buff);f._bin.t.uint16=new Uint16Array(f._bin.t.buff);f._bin.t.int32=new Int32Array(f._bin.t.buff);f._bin.t.uint32=new Uint32Array(f._bin.t.buff);f._lctf={};f._lctf.parse=function(b,a,c,d,e){var g=f._bin;c={};d=a;g.readFixed(b,a);a+=4;var h=g.readUshort(b,a);a+=2;var l=g.readUshort(b,a);a=g.readUshort(b,a+2);c.scriptList=f._lctf.readScriptList(b,
d+h);c.featureList=f._lctf.readFeatureList(b,d+l);c.lookupList=f._lctf.readLookupList(b,d+a,e);return c};f._lctf.readLookupList=function(b,a,c){var d=f._bin,e=a,g=[],h=d.readUshort(b,a);a+=2;for(var l=0;l<h;l++){var n=d.readUshort(b,a);a+=2;n=f._lctf.readLookupTable(b,e+n,c);g.push(n)}return g};f._lctf.readLookupTable=function(b,a,c){var d=f._bin,e=a,g={tabs:[]};g.ltype=d.readUshort(b,a);a+=2;g.flag=d.readUshort(b,a);a+=2;var h=d.readUshort(b,a);a+=2;for(var l=0;l<h;l++){var n=d.readUshort(b,a);a+=
2;n=c(b,g.ltype,e+n);g.tabs.push(n)}return g};f._lctf.numOfOnes=function(b){for(var a=0,c=0;32>c;c++)0!=(b>>>c&1)&&a++;return a};f._lctf.readClassDef=function(b,a){var c=f._bin,d=[],e=c.readUshort(b,a);a+=2;if(1==e){var g=c.readUshort(b,a);a+=2;var h=c.readUshort(b,a);a+=2;for(var l=0;l<h;l++)d.push(g+l),d.push(g+l),d.push(c.readUshort(b,a)),a+=2}if(2==e)for(e=c.readUshort(b,a),a+=2,l=0;l<e;l++)d.push(c.readUshort(b,a)),a+=2,d.push(c.readUshort(b,a)),a+=2,d.push(c.readUshort(b,a)),a+=2;return d};
f._lctf.getInterval=function(b,a){for(var c=0;c<b.length;c+=3){var d=b[c+1];if(b[c]<=a&&a<=d)return c}return-1};f._lctf.readCoverage=function(b,a){var c=f._bin,d={};d.fmt=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;1==d.fmt&&(d.tab=c.readUshorts(b,a,e));2==d.fmt&&(d.tab=c.readUshorts(b,a,3*e));return d};f._lctf.coverageIndex=function(b,a){var c=b.tab;return 1==b.fmt?c.indexOf(a):2==b.fmt&&(b=f._lctf.getInterval(c,a),-1!=b)?c[b+2]+(a-c[b]):-1};f._lctf.readFeatureList=function(b,a){var c=f._bin,
d=a,e=[],g=c.readUshort(b,a);a+=2;for(var h=0;h<g;h++){var l=c.readASCII(b,a,4);a+=4;var n=c.readUshort(b,a);a+=2;e.push({tag:l.trim(),tab:f._lctf.readFeatureTable(b,d+n)})}return e};f._lctf.readFeatureTable=function(b,a){var c=f._bin;c.readUshort(b,a);a+=2;var d=c.readUshort(b,a);a+=2;for(var e=[],g=0;g<d;g++)e.push(c.readUshort(b,a+2*g));return e};f._lctf.readScriptList=function(b,a){var c=f._bin,d=a,e={},g=c.readUshort(b,a);a+=2;for(var h=0;h<g;h++){var l=c.readASCII(b,a,4);a+=4;var n=c.readUshort(b,
a);a+=2;e[l.trim()]=f._lctf.readScriptTable(b,d+n)}return e};f._lctf.readScriptTable=function(b,a){var c=f._bin,d=a,e={},g=c.readUshort(b,a);a+=2;e.default=f._lctf.readLangSysTable(b,d+g);g=c.readUshort(b,a);a+=2;for(var h=0;h<g;h++){var l=c.readASCII(b,a,4);a+=4;var n=c.readUshort(b,a);a+=2;e[l.trim()]=f._lctf.readLangSysTable(b,d+n)}return e};f._lctf.readLangSysTable=function(b,a){var c=f._bin,d={};c.readUshort(b,a);a+=2;d.reqFeature=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);d.features=c.readUshorts(b,
a+2,e);return d};f.CFF={};f.CFF.parse=function(b,a,c){var d=f._bin;b=new Uint8Array(b.buffer,a,c);a=0;a++;a++;a++;a++;var e=[];a=f.CFF.readIndex(b,a,e);var g=[];for(c=0;c<e.length-1;c++)g.push(d.readASCII(b,a+e[c],e[c+1]-e[c]));a+=e[e.length-1];e=[];a=f.CFF.readIndex(b,a,e);g=[];for(c=0;c<e.length-1;c++)g.push(f.CFF.readDict(b,a+e[c],a+e[c+1]));a+=e[e.length-1];e=g[0];var h=[];a=f.CFF.readIndex(b,a,h);g=[];for(c=0;c<h.length-1;c++)g.push(d.readASCII(b,a+h[c],h[c+1]-h[c]));a+=h[h.length-1];f.CFF.readSubrs(b,
a,e);if(e.CharStrings){a=e.CharStrings;h=[];a=f.CFF.readIndex(b,a,h);var l=[];for(c=0;c<h.length-1;c++)l.push(d.readBytes(b,a+h[c],h[c+1]-h[c]));e.CharStrings=l}if(e.ROS){a=e.FDArray;h=[];a=f.CFF.readIndex(b,a,h);e.FDArray=[];for(c=0;c<h.length-1;c++)l=f.CFF.readDict(b,a+h[c],a+h[c+1]),f.CFF._readFDict(b,l,g),e.FDArray.push(l);a=e.FDSelect;e.FDSelect=[];c=b[a];a++;if(3==c)for(h=d.readUshort(b,a),a+=2,c=0;c<h+1;c++)e.FDSelect.push(d.readUshort(b,a),b[a+2]),a+=3;else throw c;}e.Encoding&&(e.Encoding=
f.CFF.readEncoding(b,e.Encoding,e.CharStrings.length));e.charset&&(e.charset=f.CFF.readCharset(b,e.charset,e.CharStrings.length));f.CFF._readFDict(b,e,g);return e};f.CFF._readFDict=function(b,a,c){if(a.Private){var d=a.Private[1];a.Private=f.CFF.readDict(b,d,d+a.Private[0]);a.Private.Subrs&&f.CFF.readSubrs(b,d+a.Private.Subrs,a.Private)}for(var e in a)-1!="FamilyName FontName FullName Notice version Copyright".split(" ").indexOf(e)&&(a[e]=c[a[e]-426+35])};f.CFF.readSubrs=function(b,a,c){var d=f._bin,
e=[];a=f.CFF.readIndex(b,a,e);var g=e.length;c.Bias=1240>g?107:33900>g?1131:32768;c.Subrs=[];for(g=0;g<e.length-1;g++)c.Subrs.push(d.readBytes(b,a+e[g],e[g+1]-e[g]))};f.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,
89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0];f.CFF.glyphByUnicode=function(b,a){for(var c=0;c<b.charset.length;c++)if(b.charset[c]==a)return c;return-1};f.CFF.glyphBySE=
function(b,a){return 0>a||255<a?-1:f.CFF.glyphByUnicode(b,f.CFF.tableSE[a])};f.CFF.readEncoding=function(b,a,c){c=[".notdef"];var d=b[a];a++;if(0==d){d=b[a];a++;for(var e=0;e<d;e++)c.push(b[a+e])}else throw"error: unknown encoding format: "+d;return c};f.CFF.readCharset=function(b,a,c){var d=f._bin,e=[".notdef"],g=b[a];a++;if(0==g)for(var h=0;h<c;h++){var l=d.readUshort(b,a);a+=2;e.push(l)}else if(1==g||2==g)for(;e.length<c;){l=d.readUshort(b,a);a+=2;if(1==g){var n=b[a];a++}else n=d.readUshort(b,
a),a+=2;for(h=0;h<=n;h++)e.push(l),l++}else throw"error: format: "+g;return e};f.CFF.readIndex=function(b,a,c){var d=f._bin,e=d.readUshort(b,a)+1;a+=2;var g=b[a];a++;if(1==g)for(var h=0;h<e;h++)c.push(b[a+h]);else if(2==g)for(h=0;h<e;h++)c.push(d.readUshort(b,a+2*h));else if(3==g)for(h=0;h<e;h++)c.push(d.readUint(b,a+3*h-1)&16777215);else if(1!=e)throw"unsupported offset size: "+g+", count: "+e;return a+e*g-1};f.CFF.getCharString=function(b,a,c){var d=f._bin,e=b[a],g=b[a+1],h=1,l=null,n=null;20>=
e&&(l=e,h=1);12==e&&(l=100*e+g,h=2);21<=e&&27>=e&&(l=e,h=1);28==e&&(n=d.readShort(b,a+1),h=3);29<=e&&31>=e&&(l=e,h=1);32<=e&&246>=e&&(n=e-139,h=1);247<=e&&250>=e&&(n=256*(e-247)+g+108,h=2);251<=e&&254>=e&&(n=256*-(e-251)-g-108,h=2);255==e&&(n=d.readInt(b,a+1)/65535,h=5);c.val=null!=n?n:"o"+l;c.size=h};f.CFF.readCharString=function(b,a,c){c=a+c;for(var d=f._bin,e=[];a<c;){var g=b[a],h=b[a+1],l=1,n=null,w=null;20>=g&&(n=g,l=1);12==g&&(n=100*g+h,l=2);if(19==g||20==g)n=g,l=2;21<=g&&27>=g&&(n=g,l=1);28==
g&&(w=d.readShort(b,a+1),l=3);29<=g&&31>=g&&(n=g,l=1);32<=g&&246>=g&&(w=g-139,l=1);247<=g&&250>=g&&(w=256*(g-247)+h+108,l=2);251<=g&&254>=g&&(w=256*-(g-251)-h-108,l=2);255==g&&(w=d.readInt(b,a+1)/65535,l=5);e.push(null!=w?w:"o"+n);a+=l}return e};f.CFF.readDict=function(b,a,c){for(var d=f._bin,e={},g=[];a<c;){var h=b[a],l=b[a+1],n=1,w=null,t=null;28==h&&(t=d.readShort(b,a+1),n=3);29==h&&(t=d.readInt(b,a+1),n=5);32<=h&&246>=h&&(t=h-139,n=1);247<=h&&250>=h&&(t=256*(h-247)+l+108,n=2);251<=h&&254>=h&&
(t=256*-(h-251)-l-108,n=2);if(255==h)throw d.readInt(b,a+1),"unknown number";if(30==h){t=[];for(n=1;;){var m=b[a+n];n++;var q=m>>4;m&=15;15!=q&&t.push(q);15!=m&&t.push(m);if(15==m)break}q="";m=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"];for(var p=0;p<t.length;p++)q+=m[t[p]];t=parseFloat(q)}21>=h&&(n="version Notice FullName FamilyName Weight FontBBox BlueValues OtherBlues FamilyBlues FamilyOtherBlues StdHW StdVW escape UniqueID XUID charset Encoding CharStrings Private Subrs defaultWidthX nominalWidthX".split(" "),
w=n[h],n=1,12==h&&(n=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"],w=n[l],n=2));null!=w?(e[w]=1==g.length?
g[0]:g,g=[]):g.push(t);a+=n}return e};f.cmap={};f.cmap.parse=function(b,a,c){b=new Uint8Array(b.buffer,a,c);a=0;c=f._bin;var d={};c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;var g=[];d.tables=[];for(var h=0;h<e;h++){var l=c.readUshort(b,a);a+=2;var n=c.readUshort(b,a);a+=2;var w=c.readUint(b,a);a+=4;var t="p"+l+"e"+n,m=g.indexOf(w);if(-1==m){m=d.tables.length;var q;g.push(w);var p=c.readUshort(b,w);0==p?q=f.cmap.parse0(b,w):4==p?q=f.cmap.parse4(b,w):6==p?q=f.cmap.parse6(b,w):12==p?q=f.cmap.parse12(b,
w):console.log("unknown format: "+p,l,n,w);d.tables.push(q)}if(null!=d[t])throw"multiple tables for one platform+encoding";d[t]=m}return d};f.cmap.parse0=function(b,a){var c=f._bin,d={};d.format=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;d.map=[];for(c=0;c<e-6;c++)d.map.push(b[a+c]);return d};f.cmap.parse4=function(b,a){var c=f._bin,d=a,e={};e.format=c.readUshort(b,a);a+=2;var g=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;var h=c.readUshort(b,a);a+=2;h/=2;e.searchRange=
c.readUshort(b,a);a+=2;e.entrySelector=c.readUshort(b,a);a+=2;e.rangeShift=c.readUshort(b,a);a+=2;e.endCount=c.readUshorts(b,a,h);a=a+2*h+2;e.startCount=c.readUshorts(b,a,h);a+=2*h;e.idDelta=[];for(var l=0;l<h;l++)e.idDelta.push(c.readShort(b,a)),a+=2;e.idRangeOffset=c.readUshorts(b,a,h);a+=2*h;for(e.glyphIdArray=[];a<d+g;)e.glyphIdArray.push(c.readUshort(b,a)),a+=2;return e};f.cmap.parse6=function(b,a){var c=f._bin,d={};d.format=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=
2;d.firstCode=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;d.glyphIdArray=[];for(var g=0;g<e;g++)d.glyphIdArray.push(c.readUshort(b,a)),a+=2;return d};f.cmap.parse12=function(b,a){var c=f._bin,d={};d.format=c.readUshort(b,a);a=a+2+2;c.readUint(b,a);a+=4;c.readUint(b,a);a+=4;var e=c.readUint(b,a);a+=4;d.groups=[];for(var g=0;g<e;g++){var h=a+12*g,l=c.readUint(b,h+0),n=c.readUint(b,h+4);h=c.readUint(b,h+8);d.groups.push([l,n,h])}return d};f.glyf={};f.glyf.parse=function(b,a,c,d){b=[];for(a=0;a<
d.maxp.numGlyphs;a++)b.push(null);return b};f.glyf._parseGlyf=function(b,a){var c=f._bin,d=b._data,e=f._tabOffset(d,"glyf",b._offset)+b.loca[a];if(b.loca[a]==b.loca[a+1])return null;b={};b.noc=c.readShort(d,e);e+=2;b.xMin=c.readShort(d,e);e+=2;b.yMin=c.readShort(d,e);e+=2;b.xMax=c.readShort(d,e);e+=2;b.yMax=c.readShort(d,e);e+=2;if(b.xMin>=b.xMax||b.yMin>=b.yMax)return null;if(0<b.noc){b.endPts=[];for(a=0;a<b.noc;a++)b.endPts.push(c.readUshort(d,e)),e+=2;a=c.readUshort(d,e);e+=2;if(d.length-e<a)return null;
b.instructions=c.readBytes(d,e,a);e+=a;var g=b.endPts[b.noc-1]+1;b.flags=[];for(a=0;a<g;a++){var h=d[e];e++;b.flags.push(h);if(0!=(h&8)){var l=d[e];e++;for(var n=0;n<l;n++)b.flags.push(h),a++}}b.xs=[];for(a=0;a<g;a++)h=0!=(b.flags[a]&2),l=0!=(b.flags[a]&16),h?(b.xs.push(l?d[e]:-d[e]),e++):l?b.xs.push(0):(b.xs.push(c.readShort(d,e)),e+=2);b.ys=[];for(a=0;a<g;a++)h=0!=(b.flags[a]&4),l=0!=(b.flags[a]&32),h?(b.ys.push(l?d[e]:-d[e]),e++):l?b.ys.push(0):(b.ys.push(c.readShort(d,e)),e+=2);for(a=e=d=0;a<
g;a++)d+=b.xs[a],e+=b.ys[a],b.xs[a]=d,b.ys[a]=e}else{b.parts=[];do a=c.readUshort(d,e),e+=2,g={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1},b.parts.push(g),g.glyphIndex=c.readUshort(d,e),e+=2,a&1?(h=c.readShort(d,e),e+=2,l=c.readShort(d,e),e+=2):(h=c.readInt8(d,e),e++,l=c.readInt8(d,e),e++),a&2?(g.m.tx=h,g.m.ty=l):(g.p1=h,g.p2=l),a&8?(g.m.a=g.m.d=c.readF2dot14(d,e),e+=2):a&64?(g.m.a=c.readF2dot14(d,e),e+=2,g.m.d=c.readF2dot14(d,e),e+=2):a&128&&(g.m.a=c.readF2dot14(d,e),e+=2,g.m.b=c.readF2dot14(d,e),
e+=2,g.m.c=c.readF2dot14(d,e),e+=2,g.m.d=c.readF2dot14(d,e),e+=2);while(a&32);if(a&256)for(c=c.readUshort(d,e),e+=2,b.instr=[],a=0;a<c;a++)b.instr.push(d[e]),e++}return b};f.GPOS={};f.GPOS.parse=function(b,a,c,d){return f._lctf.parse(b,a,c,d,f.GPOS.subt)};f.GPOS.subt=function(b,a,c){var d=f._bin,e=c,g={};g.fmt=d.readUshort(b,c);c+=2;if(1==a||2==a||3==a||7==a||8==a&&2>=g.fmt){var h=d.readUshort(b,c);c+=2;g.coverage=f._lctf.readCoverage(b,h+e)}if(1==a&&1==g.fmt){var l=d.readUshort(b,c);c+=2;f._lctf.numOfOnes(l);
0!=l&&(g.pos=f.GPOS.readValueRecord(b,c,l))}else if(2==a){l=d.readUshort(b,c);c+=2;var n=d.readUshort(b,c);c+=2;a=f._lctf.numOfOnes(l);h=f._lctf.numOfOnes(n);if(1==g.fmt){g.pairsets=[];var w=d.readUshort(b,c);c+=2;for(var t=0;t<w;t++){var m=e+d.readUshort(b,c);c+=2;var q=d.readUshort(b,m);m+=2;for(var p=[],r=0;r<q;r++){var k=d.readUshort(b,m);m+=2;if(0!=l){var u=f.GPOS.readValueRecord(b,m,l);m+=2*a}if(0!=n){var z=f.GPOS.readValueRecord(b,m,n);m+=2*h}p.push({gid2:k,val1:u,val2:z})}g.pairsets.push(p)}}if(2==
g.fmt)for(u=d.readUshort(b,c),c+=2,z=d.readUshort(b,c),c+=2,l=d.readUshort(b,c),c+=2,d=d.readUshort(b,c),c+=2,g.classDef1=f._lctf.readClassDef(b,e+u),g.classDef2=f._lctf.readClassDef(b,e+z),g.matrix=[],t=0;t<l;t++){e=[];for(r=0;r<d;r++)z=u=null,0!=g.valFmt1&&(u=f.GPOS.readValueRecord(b,c,g.valFmt1),c+=2*a),0!=g.valFmt2&&(z=f.GPOS.readValueRecord(b,c,g.valFmt2),c+=2*h),e.push({val1:u,val2:z});g.matrix.push(e)}}return g};f.GPOS.readValueRecord=function(b,a,c){var d=f._bin,e=[];e.push(c&1?d.readShort(b,
a):0);a+=c&1?2:0;e.push(c&2?d.readShort(b,a):0);a+=c&2?2:0;e.push(c&4?d.readShort(b,a):0);e.push(c&8?d.readShort(b,a+(c&4?2:0)):0);return e};f.GSUB={};f.GSUB.parse=function(b,a,c,d){return f._lctf.parse(b,a,c,d,f.GSUB.subt)};f.GSUB.subt=function(b,a,c){var d=f._bin,e=c,g={};g.fmt=d.readUshort(b,c);c+=2;if(1!=a&&4!=a&&5!=a&&6!=a)return null;if(1==a||4==a||5==a&&2>=g.fmt||6==a&&2>=g.fmt){var h=d.readUshort(b,c);c+=2;g.coverage=f._lctf.readCoverage(b,e+h)}if(1==a)1==g.fmt?g.delta=d.readShort(b,c):2==
g.fmt&&(h=d.readUshort(b,c),g.newg=d.readUshorts(b,c+2,h));else if(4==a)for(g.vals=[],h=d.readUshort(b,c),c+=2,a=0;a<h;a++){var l=d.readUshort(b,c);c+=2;g.vals.push(f.GSUB.readLigatureSet(b,e+l))}else if(5==a){if(2==g.fmt)for(a=d.readUshort(b,c),c+=2,g.cDef=f._lctf.readClassDef(b,e+a),g.scset=[],h=d.readUshort(b,c),c+=2,a=0;a<h;a++)l=d.readUshort(b,c),c+=2,g.scset.push(0==l?null:f.GSUB.readSubClassSet(b,e+l))}else if(6==a&&3==g.fmt){for(a=0;3>a;a++){h=d.readUshort(b,c);c+=2;l=[];for(var n=0;n<h;n++)l.push(f._lctf.readCoverage(b,
e+d.readUshort(b,c+2*n)));c+=2*h;0==a&&(g.backCvg=l);1==a&&(g.inptCvg=l);2==a&&(g.ahedCvg=l)}h=d.readUshort(b,c);g.lookupRec=f.GSUB.readSubstLookupRecords(b,c+2,h)}return g};f.GSUB.readSubClassSet=function(b,a){var c=f._bin.readUshort,d=a,e=[],g=c(b,a);a+=2;for(var h=0;h<g;h++){var l=c(b,a);a+=2;e.push(f.GSUB.readSubClassRule(b,d+l))}return e};f.GSUB.readSubClassRule=function(b,a){var c=f._bin.readUshort,d={},e=c(b,a);a+=2;var g=c(b,a);a+=2;d.input=[];for(var h=0;h<e-1;h++)d.input.push(c(b,a)),a+=
2;d.substLookupRecords=f.GSUB.readSubstLookupRecords(b,a,g);return d};f.GSUB.readSubstLookupRecords=function(b,a,c){for(var d=f._bin.readUshort,e=[],g=0;g<c;g++)e.push(d(b,a),d(b,a+2)),a+=4;return e};f.GSUB.readChainSubClassSet=function(b,a){var c=f._bin,d=a,e=[],g=c.readUshort(b,a);a+=2;for(var h=0;h<g;h++){var l=c.readUshort(b,a);a+=2;e.push(f.GSUB.readChainSubClassRule(b,d+l))}return e};f.GSUB.readChainSubClassRule=function(b,a){for(var c=f._bin,d={},e=["backtrack","input","lookahead"],g=0;g<e.length;g++){var h=
c.readUshort(b,a);a+=2;1==g&&h--;d[e[g]]=c.readUshorts(b,a,h);a+=2*d[e[g]].length}h=c.readUshort(b,a);d.subst=c.readUshorts(b,a+2,2*h);return d};f.GSUB.readLigatureSet=function(b,a){var c=f._bin,d=a,e=[],g=c.readUshort(b,a);a+=2;for(var h=0;h<g;h++){var l=c.readUshort(b,a);a+=2;e.push(f.GSUB.readLigature(b,d+l))}return e};f.GSUB.readLigature=function(b,a){var c=f._bin,d={chain:[]};d.nglyph=c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;for(var g=0;g<e-1;g++)d.chain.push(c.readUshort(b,a)),a+=
2;return d};f.head={};f.head.parse=function(b,a,c){c=f._bin;var d={};c.readFixed(b,a);a+=4;d.fontRevision=c.readFixed(b,a);a+=4;c.readUint(b,a);a+=4;c.readUint(b,a);a+=4;d.flags=c.readUshort(b,a);a+=2;d.unitsPerEm=c.readUshort(b,a);a+=2;d.created=c.readUint64(b,a);a+=8;d.modified=c.readUint64(b,a);a+=8;d.xMin=c.readShort(b,a);a+=2;d.yMin=c.readShort(b,a);a+=2;d.xMax=c.readShort(b,a);a+=2;d.yMax=c.readShort(b,a);a+=2;d.macStyle=c.readUshort(b,a);a+=2;d.lowestRecPPEM=c.readUshort(b,a);a+=2;d.fontDirectionHint=
c.readShort(b,a);a+=2;d.indexToLocFormat=c.readShort(b,a);d.glyphDataFormat=c.readShort(b,a+2);return d};f.hhea={};f.hhea.parse=function(b,a,c){c=f._bin;var d={};c.readFixed(b,a);a+=4;d.ascender=c.readShort(b,a);a+=2;d.descender=c.readShort(b,a);a+=2;d.lineGap=c.readShort(b,a);a+=2;d.advanceWidthMax=c.readUshort(b,a);a+=2;d.minLeftSideBearing=c.readShort(b,a);a+=2;d.minRightSideBearing=c.readShort(b,a);a+=2;d.xMaxExtent=c.readShort(b,a);a+=2;d.caretSlopeRise=c.readShort(b,a);a+=2;d.caretSlopeRun=
c.readShort(b,a);a+=2;d.caretOffset=c.readShort(b,a);a=a+2+8;d.metricDataFormat=c.readShort(b,a);d.numberOfHMetrics=c.readUshort(b,a+2);return d};f.hmtx={};f.hmtx.parse=function(b,a,c,d){c=f._bin;for(var e={aWidth:[],lsBearing:[]},g=0,h=0,l=0;l<d.maxp.numGlyphs;l++)l<d.hhea.numberOfHMetrics&&(g=c.readUshort(b,a),a+=2,h=c.readShort(b,a),a+=2),e.aWidth.push(g),e.lsBearing.push(h);return e};f.kern={};f.kern.parse=function(b,a,c,d){var e=f._bin,g=e.readUshort(b,a);a+=2;if(1==g)return f.kern.parseV1(b,
a-2,c,d);c=e.readUshort(b,a);a+=2;d={glyph1:[],rval:[]};for(g=0;g<c;g++){a+=2;e.readUshort(b,a);a+=2;var h=e.readUshort(b,a);a+=2;h>>>=8;h&=15;if(0==h)a=f.kern.readFormat0(b,a,d);else throw"unknown kern table format: "+h;}return d};f.kern.parseV1=function(b,a,c,d){c=f._bin;c.readFixed(b,a);a+=4;d=c.readUint(b,a);a+=4;for(var e={glyph1:[],rval:[]},g=0;g<d;g++){c.readUint(b,a);a+=4;var h=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;h>>>=8;h&=15;if(0==h)a=f.kern.readFormat0(b,a,e);else throw"unknown kern table format: "+
h;}return e};f.kern.readFormat0=function(b,a,c){var d=f._bin,e=-1,g=d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;d.readUshort(b,a);a+=2;for(var h=0;h<g;h++){var l=d.readUshort(b,a);a+=2;var n=d.readUshort(b,a);a+=2;var w=d.readShort(b,a);a+=2;l!=e&&(c.glyph1.push(l),c.rval.push({glyph2:[],vals:[]}));e=c.rval[c.rval.length-1];e.glyph2.push(n);e.vals.push(w);e=l}return a};f.loca={};f.loca.parse=function(b,a,c,d){c=f._bin;var e=[],g=d.head.indexToLocFormat;d=d.maxp.numGlyphs+
1;if(0==g)for(var h=0;h<d;h++)e.push(c.readUshort(b,a+(h<<1))<<1);if(1==g)for(h=0;h<d;h++)e.push(c.readUint(b,a+(h<<2)));return e};f.maxp={};f.maxp.parse=function(b,a,c){c=f._bin;var d={},e=c.readUint(b,a);a+=4;d.numGlyphs=c.readUshort(b,a);a+=2;65536==e&&(d.maxPoints=c.readUshort(b,a),a+=2,d.maxContours=c.readUshort(b,a),a+=2,d.maxCompositePoints=c.readUshort(b,a),a+=2,d.maxCompositeContours=c.readUshort(b,a),a+=2,d.maxZones=c.readUshort(b,a),a+=2,d.maxTwilightPoints=c.readUshort(b,a),a+=2,d.maxStorage=
c.readUshort(b,a),a+=2,d.maxFunctionDefs=c.readUshort(b,a),a+=2,d.maxInstructionDefs=c.readUshort(b,a),a+=2,d.maxStackElements=c.readUshort(b,a),a+=2,d.maxSizeOfInstructions=c.readUshort(b,a),a+=2,d.maxComponentElements=c.readUshort(b,a),d.maxComponentDepth=c.readUshort(b,a+2));return d};f.name={};f.name.parse=function(b,a,c){c=f._bin;var d={};c.readUshort(b,a);a+=2;var e=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;for(var g="copyright fontFamily fontSubfamily ID fullName version postScriptName trademark manufacturer designer description urlVendor urlDesigner licence licenceURL --- typoFamilyName typoSubfamilyName compatibleFull sampleText postScriptCID wwsFamilyName wwsSubfamilyName lightPalette darkPalette".split(" "),
h=a,l=0;l<e;l++){var n=c.readUshort(b,a);a+=2;var w=c.readUshort(b,a);a+=2;var t=c.readUshort(b,a);a+=2;var m=c.readUshort(b,a);a+=2;var q=c.readUshort(b,a);a+=2;var p=c.readUshort(b,a);a+=2;m=g[m];p=h+12*e+p;if(0==n)q=c.readUnicode(b,p,q/2);else if(3==n&&0==w)q=c.readUnicode(b,p,q/2);else if(0==w)q=c.readASCII(b,p,q);else if(1==w)q=c.readUnicode(b,p,q/2);else if(3==w)q=c.readUnicode(b,p,q/2);else if(1==n)q=c.readASCII(b,p,q),console.log("reading unknown MAC encoding "+w+" as ASCII");else throw"unknown encoding "+
w+", platformID: "+n;n="p"+n+","+t.toString(16);null==d[n]&&(d[n]={});d[n][m]=q;d[n]._lang=t}for(var r in d)if(null!=d[r].postScriptName&&1033==d[r]._lang)return d[r];for(r in d)if(null!=d[r].postScriptName&&0==d[r]._lang)return d[r];for(r in d)if(null!=d[r].postScriptName&&3084==d[r]._lang)return d[r];for(r in d)if(null!=d[r].postScriptName)return d[r];for(r in d){var k=r;break}console.log("returning name table with languageID "+d[k]._lang);return d[k]};f["OS/2"]={};f["OS/2"].parse=function(b,a,
c){c=f._bin.readUshort(b,a);a+=2;var d={};if(0==c)f["OS/2"].version0(b,a,d);else if(1==c)f["OS/2"].version1(b,a,d);else if(2==c||3==c||4==c)f["OS/2"].version2(b,a,d);else if(5==c)f["OS/2"].version5(b,a,d);else throw"unknown OS/2 table version: "+c;return d};f["OS/2"].version0=function(b,a,c){var d=f._bin;c.xAvgCharWidth=d.readShort(b,a);a+=2;c.usWeightClass=d.readUshort(b,a);a+=2;c.usWidthClass=d.readUshort(b,a);a+=2;c.fsType=d.readUshort(b,a);a+=2;c.ySubscriptXSize=d.readShort(b,a);a+=2;c.ySubscriptYSize=
d.readShort(b,a);a+=2;c.ySubscriptXOffset=d.readShort(b,a);a+=2;c.ySubscriptYOffset=d.readShort(b,a);a+=2;c.ySuperscriptXSize=d.readShort(b,a);a+=2;c.ySuperscriptYSize=d.readShort(b,a);a+=2;c.ySuperscriptXOffset=d.readShort(b,a);a+=2;c.ySuperscriptYOffset=d.readShort(b,a);a+=2;c.yStrikeoutSize=d.readShort(b,a);a+=2;c.yStrikeoutPosition=d.readShort(b,a);a+=2;c.sFamilyClass=d.readShort(b,a);a+=2;c.panose=d.readBytes(b,a,10);a+=10;c.ulUnicodeRange1=d.readUint(b,a);a+=4;c.ulUnicodeRange2=d.readUint(b,
a);a+=4;c.ulUnicodeRange3=d.readUint(b,a);a+=4;c.ulUnicodeRange4=d.readUint(b,a);a+=4;c.achVendID=[d.readInt8(b,a),d.readInt8(b,a+1),d.readInt8(b,a+2),d.readInt8(b,a+3)];a+=4;c.fsSelection=d.readUshort(b,a);a+=2;c.usFirstCharIndex=d.readUshort(b,a);a+=2;c.usLastCharIndex=d.readUshort(b,a);a+=2;c.sTypoAscender=d.readShort(b,a);a+=2;c.sTypoDescender=d.readShort(b,a);a+=2;c.sTypoLineGap=d.readShort(b,a);a+=2;c.usWinAscent=d.readUshort(b,a);a+=2;c.usWinDescent=d.readUshort(b,a);return a+2};f["OS/2"].version1=
function(b,a,c){var d=f._bin;a=f["OS/2"].version0(b,a,c);c.ulCodePageRange1=d.readUint(b,a);a+=4;c.ulCodePageRange2=d.readUint(b,a);return a+4};f["OS/2"].version2=function(b,a,c){var d=f._bin;a=f["OS/2"].version1(b,a,c);c.sxHeight=d.readShort(b,a);a+=2;c.sCapHeight=d.readShort(b,a);a+=2;c.usDefault=d.readUshort(b,a);a+=2;c.usBreak=d.readUshort(b,a);a+=2;c.usMaxContext=d.readUshort(b,a);return a+2};f["OS/2"].version5=function(b,a,c){var d=f._bin;a=f["OS/2"].version2(b,a,c);c.usLowerOpticalPointSize=
d.readUshort(b,a);a+=2;c.usUpperOpticalPointSize=d.readUshort(b,a);return a+2};f.post={};f.post.parse=function(b,a,c){c=f._bin;var d={};d.version=c.readFixed(b,a);a+=4;d.italicAngle=c.readFixed(b,a);a+=4;d.underlinePosition=c.readShort(b,a);d.underlineThickness=c.readShort(b,a+2);return d};f.SVG={};f.SVG.parse=function(b,a,c){c=f._bin;var d={entries:[]},e=a;c.readUshort(b,a);a+=2;var g=c.readUint(b,a);c.readUint(b,a+4);a=g+e;var h=c.readUshort(b,a);a+=2;for(var l=0;l<h;l++){var n=c.readUshort(b,a);
a+=2;var w=c.readUshort(b,a);a+=2;var k=c.readUint(b,a);a+=4;var m=c.readUint(b,a);a+=4;k=new Uint8Array(b.buffer,e+k+g,m);for(k=c.readUTF8(k,0,k.length);n<=w;n++)d.entries[n]=k}return d};f.SVG.toPath=function(b){var a={cmds:[],crds:[]};if(null==b)return a;for(var c=(new DOMParser).parseFromString(b,"image/svg+xml").firstChild;"svg"!=c.tagName;)c=c.nextSibling;b=(b=c.getAttribute("viewBox"))?b.trim().split(" ").map(parseFloat):[0,0,1E3,1E3];f.SVG._toPath(c.children,a);for(c=0;c<a.crds.length;c+=2){var d=
a.crds[c],e=a.crds[c+1];d-=b[0];e-=b[1];e=-e;a.crds[c]=d;a.crds[c+1]=e}return a};f.SVG._toPath=function(b,a,c){for(var d=0;d<b.length;d++){var e=b[d],g=e.tagName,h=e.getAttribute("fill");null==h&&(h=c);"g"==g?f.SVG._toPath(e.children,a,h):"path"==g?(a.cmds.push(h?h:"#000000"),e=e.getAttribute("d"),e=f.SVG._tokens(e),f.SVG._toksToPath(e,a),a.cmds.push("X")):"defs"!=g&&console.log(g,e)}};f.SVG._tokens=function(b){for(var a=[],c=0,d=!1,e="";c<b.length;){var g=b.charCodeAt(c),f=b.charAt(c);c++;g=48<=
g&&57>=g||"."==f||"-"==f;d?"-"==f?(a.push(parseFloat(e)),e=f):g?e+=f:(a.push(parseFloat(e)),","!=f&&" "!=f&&a.push(f),d=!1):g?(e=f,d=!0):","!=f&&" "!=f&&a.push(f)}d&&a.push(parseFloat(e));return a};f.SVG._toksToPath=function(b,a){var c=0,d=0,e=0,g=0,h=0,l={M:2,L:2,H:1,V:1,S:4,C:6},n=a.cmds;for(a=a.crds;c<b.length;){var w=b[c];c++;if("z"==w)n.push("Z"),d=g,e=h;else for(var k=w.toUpperCase(),m=f.SVG._reps(b,c,l[k]),q=0;q<m;q++){var p=0,r=0;w!=k&&(p=d,r=e);if("M"==k)d=p+b[c++],e=r+b[c++],n.push("M"),
a.push(d,e),g=d,h=e;else if("L"==k)d=p+b[c++],e=r+b[c++],n.push("L"),a.push(d,e);else if("H"==k)d=p+b[c++],n.push("L"),a.push(d,e);else if("V"==k)e=r+b[c++],n.push("L"),a.push(d,e);else if("C"==k){d=p+b[c++];e=r+b[c++];var v=p+b[c++],u=r+b[c++];p+=b[c++];r+=b[c++];n.push("C");a.push(d,e,v,u,p,r);d=p;e=r}else"S"==k?(v=Math.max(a.length-4,0),d=d+d-a[v],e=e+e-a[v+1],v=p+b[c++],u=r+b[c++],p+=b[c++],r+=b[c++],n.push("C"),a.push(d,e,v,u,p,r),d=p,e=r):console.log("Unknown SVG command "+w)}}};f.SVG._reps=
function(b,a,c){for(var d=a;d<b.length&&"string"!=typeof b[d];)d+=c;return(d-a)/c};null==f&&(f={});null==f.U&&(f.U={});f.U.codeToGlyph=function(b,a){b=b.cmap;var c=-1;null!=b.p0e4?c=b.p0e4:null!=b.p3e1?c=b.p3e1:null!=b.p1e0?c=b.p1e0:null!=b.p0e3&&(c=b.p0e3);if(-1==c)throw"no familiar platform and encoding!";b=b.tables[c];if(0==b.format)return a>=b.map.length?0:b.map[a];if(4==b.format){var d=-1;for(c=0;c<b.endCount.length;c++)if(a<=b.endCount[c]){d=c;break}return-1==d||b.startCount[d]>a?0:(0!=b.idRangeOffset[d]?
b.glyphIdArray[a-b.startCount[d]+(b.idRangeOffset[d]>>1)-(b.idRangeOffset.length-d)]:a+b.idDelta[d])&65535}if(12==b.format){if(a>b.groups[b.groups.length-1][1])return 0;for(c=0;c<b.groups.length;c++)if(d=b.groups[c],d[0]<=a&&a<=d[1])return d[2]+(a-d[0]);return 0}throw"unknown cmap table format "+b.format;};f.U.glyphToPath=function(b,a){var c={cmds:[],crds:[]};if(b.SVG&&b.SVG.entries[a]){var d=b.SVG.entries[a];if(null==d)return c;"string"==typeof d&&(d=f.SVG.toPath(d),b.SVG.entries[a]=d);return d}if(b.CFF){d=
{x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:b.CFF.Private?b.CFF.Private.defaultWidthX:0,open:!1};var e=b.CFF,g=b.CFF.Private;if(e.ROS){for(g=0;e.FDSelect[g+2]<=a;)g+=2;g=e.FDArray[e.FDSelect[g+1]].Private}f.U._drawCFF(b.CFF.CharStrings[a],d,e,g,c)}else b.glyf&&f.U._drawGlyf(a,b,c);return c};f.U._drawGlyf=function(b,a,c){var d=a.glyf[b];null==d&&(d=a.glyf[b]=f.glyf._parseGlyf(a,b));null!=d&&(-1<d.noc?f.U._simpleGlyph(d,c):f.U._compoGlyph(d,a,c))};f.U._simpleGlyph=function(b,a){for(var c=0;c<b.noc;c++){for(var d=
0==c?0:b.endPts[c-1]+1,e=b.endPts[c],g=d;g<=e;g++){var h=g==d?e:g-1,l=g==e?d:g+1,n=b.flags[g]&1,k=b.flags[h]&1,t=b.flags[l]&1,m=b.xs[g],q=b.ys[g];if(g==d)if(n)if(k)f.U.P.moveTo(a,b.xs[h],b.ys[h]);else{f.U.P.moveTo(a,m,q);continue}else k?f.U.P.moveTo(a,b.xs[h],b.ys[h]):f.U.P.moveTo(a,(b.xs[h]+m)/2,(b.ys[h]+q)/2);n?k&&f.U.P.lineTo(a,m,q):t?f.U.P.qcurveTo(a,m,q,b.xs[l],b.ys[l]):f.U.P.qcurveTo(a,m,q,(m+b.xs[l])/2,(q+b.ys[l])/2)}f.U.P.closePath(a)}};f.U._compoGlyph=function(b,a,c){for(var d=0;d<b.parts.length;d++){var e=
{cmds:[],crds:[]},g=b.parts[d];f.U._drawGlyf(g.glyphIndex,a,e);g=g.m;for(var h=0;h<e.crds.length;h+=2){var l=e.crds[h],n=e.crds[h+1];c.crds.push(l*g.a+n*g.b+g.tx);c.crds.push(l*g.c+n*g.d+g.ty)}for(h=0;h<e.cmds.length;h++)c.cmds.push(e.cmds[h])}};f.U._getGlyphClass=function(b,a){b=f._lctf.getInterval(a,b);return-1==b?0:a[b+2]};f.U.getPairAdjustment=function(b,a,c){if(b.GPOS){var d=b.GPOS,e=d.lookupList;d=d.featureList;for(var g=[],h=0;h<d.length;h++){var l=d[h];if("kern"==l.tag)for(var n=0;n<l.tab.length;n++)if(!g[l.tab[n]]){g[l.tab[n]]=
!0;for(var k=e[l.tab[n]],t=0;t<k.tabs.length;t++)if(null!=k.tabs[h]){var m=k.tabs[t];if(m.coverage){var q=f._lctf.coverageIndex(m.coverage,a);if(-1==q)continue}if(1!=k.ltype&&2==k.ltype){var p;if(1==m.fmt)for(m=m.pairsets[q],h=0;h<m.length;h++)m[h].gid2==c&&(p=m[h]);else if(2==m.fmt){p=f.U._getGlyphClass(a,m.classDef1);var r=f.U._getGlyphClass(c,m.classDef2);p=m.matrix[p][r]}if(p&&p.val2)return p.val2[2]}}}}}return b.kern&&(a=b.kern.glyph1.indexOf(a),-1!=a&&(c=b.kern.rval[a].glyph2.indexOf(c),-1!=
c))?b.kern.rval[a].vals[c]:0};f.U.stringToGlyphs=function(b,a){for(var c=[],d=0;d<a.length;d++){var e=a.codePointAt(d);65535<e&&d++;c.push(f.U.codeToGlyph(b,e))}for(d=0;d<a.length;d++){e=a.codePointAt(d);if(2367==e){var g=c[d-1];c[d-1]=c[d];c[d]=g}65535<e&&d++}d=b.GSUB;if(null==d)return c;b=d.lookupList;d=d.featureList;e="rlig liga mset isol init fina medi half pres blws".split(" ");g=[];for(var h=0;h<d.length;h++){var l=d[h];if(-1!=e.indexOf(l.tag))for(var n=0;n<l.tab.length;n++)if(!g[l.tab[n]]){g[l.tab[n]]=
!0;for(var k=b[l.tab[n]],t=0;t<c.length;t++){var m=f.U._getWPfeature(a,t);-1!="isol,init,fina,medi".indexOf(l.tag)&&l.tag!=m||f.U._applySubs(c,t,k,b)}}}return c};f.U._getWPfeature=function(b,a){var c=0==a||-1!='\n\t" ,.:;!?()  \u060c'.indexOf(b[a-1]),d=a==b.length-1||-1!='\n\t" ,.:;!?()  \u060c'.indexOf(b[a+1]);c||-1=="\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0671\u0672\u0673\u0675\u0676\u0677\u0688\u0689\u068a\u068b\u068c\u068d\u068e\u068f\u0690\u0691\u0692\u0693\u0694\u0695\u0696\u0697\u0698\u0699\u06c0\u06c3\u06c4\u06c5\u06c6\u06c7\u06c8\u06c9\u06ca\u06cb\u06cd\u06cf\u06d2\u06d3\u06d5\u06ee\u06ef\u0710\u0715\u0716\u0717\u0718\u0719\u071e\u0728\u072a\u072c\u072f\u074d\u0759\u075a\u075b\u076b\u076c\u0771\u0773\u0774\u0778\u0779\u0840\u0846\u0847\u0849\u0854\u0867\u0869\u086a\u08aa\u08ab\u08ac\u08ae\u08b1\u08b2\u08b9\u0ac5\u0ac7\u0ac9\u0aca\u0ace\u0acf\u0ad0\u0ad1\u0ad2\u0add\u0ae1\u0ae4\u0aef\u0b81\u0b83\u0b84\u0b85\u0b89\u0b8c\u0b8e\u0b8f\u0b91\u0ba9\u0baa\u0bab\u0bac".indexOf(b[a-
1])||(c=!0);d||-1=="\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0671\u0672\u0673\u0675\u0676\u0677\u0688\u0689\u068a\u068b\u068c\u068d\u068e\u068f\u0690\u0691\u0692\u0693\u0694\u0695\u0696\u0697\u0698\u0699\u06c0\u06c3\u06c4\u06c5\u06c6\u06c7\u06c8\u06c9\u06ca\u06cb\u06cd\u06cf\u06d2\u06d3\u06d5\u06ee\u06ef\u0710\u0715\u0716\u0717\u0718\u0719\u071e\u0728\u072a\u072c\u072f\u074d\u0759\u075a\u075b\u076b\u076c\u0771\u0773\u0774\u0778\u0779\u0840\u0846\u0847\u0849\u0854\u0867\u0869\u086a\u08aa\u08ab\u08ac\u08ae\u08b1\u08b2\u08b9\u0ac5\u0ac7\u0ac9\u0aca\u0ace\u0acf\u0ad0\u0ad1\u0ad2\u0add\u0ae1\u0ae4\u0aef\u0b81\u0b83\u0b84\u0b85\u0b89\u0b8c\u0b8e\u0b8f\u0b91\u0ba9\u0baa\u0bab\u0bac".indexOf(b[a])||
(d=!0);d||-1=="\ua872\u0acd\u0ad7".indexOf(b[a+1])||(d=!0);c||-1=="\ua872\u0acd\u0ad7".indexOf(b[a])||(c=!0);return c?d?"isol":"init":d?"fina":"medi"};f.U._applySubs=function(b,a,c,d){for(var e=b.length-a-1,g=0;g<c.tabs.length;g++)if(null!=c.tabs[g]){var h=c.tabs[g];if(h.coverage){var l=f._lctf.coverageIndex(h.coverage,b[a]);if(-1==l)continue}if(1==c.ltype)b[a]=1==h.fmt?b[a]+h.delta:h.newg[l];else if(4==c.ltype)for(var n=h.vals[l],k=0;k<n.length;k++){var t=n[k];h=t.chain.length;if(!(h>e)){for(var m=
!0,q=0,p=0;p<h;p++){for(;-1==b[a+q+(1+p)];)q++;t.chain[p]!=b[a+q+(1+p)]&&(m=!1)}if(m){b[a]=t.nglyph;for(p=0;p<h+q;p++)b[a+p+1]=-1;break}}}else if(5==c.ltype&&2==h.fmt)for(n=f._lctf.getInterval(h.cDef,b[a]),q=h.scset[h.cDef[n+2]],t=0;t<q.length;t++){k=q[t];var r=k.input;if(!(r.length>e)){m=!0;for(p=0;p<r.length;p++){var v=f._lctf.getInterval(h.cDef,b[a+1+p]);if(-1==n&&h.cDef[v+2]!=r[p]){m=!1;break}}if(m)for(m=k.substLookupRecords,k=0;k<m.length;k+=2);}}else if(6==c.ltype&&3==h.fmt&&f.U._glsCovered(b,
h.backCvg,a-h.backCvg.length)&&f.U._glsCovered(b,h.inptCvg,a)&&f.U._glsCovered(b,h.ahedCvg,a+h.inptCvg.length))for(m=h.lookupRec,t=0;t<m.length;t+=2)n=m[t],f.U._applySubs(b,a+n,d[m[t+1]],d)}};f.U._glsCovered=function(b,a,c){for(var d=0;d<a.length;d++)if(-1==f._lctf.coverageIndex(a[d],b[c+d]))return!1;return!0};f.U.glyphsToPath=function(b,a,c){for(var d={cmds:[],crds:[]},e=0,g=0;g<a.length;g++){var h=a[g];if(-1!=h){for(var l=g<a.length-1&&-1!=a[g+1]?a[g+1]:0,n=f.U.glyphToPath(b,h),k=0;k<n.crds.length;k+=
2)d.crds.push(n.crds[k]+e),d.crds.push(n.crds[k+1]);c&&d.cmds.push(c);for(k=0;k<n.cmds.length;k++)d.cmds.push(n.cmds[k]);c&&d.cmds.push("X");e+=b.hmtx.aWidth[h];g<a.length-1&&(e+=f.U.getPairAdjustment(b,h,l))}}return d};f.U.pathToSVG=function(b,a){null==a&&(a=5);for(var c=[],d=0,e={M:2,L:2,Q:4,C:6},g=0;g<b.cmds.length;g++){var f=b.cmds[g],l=d+(e[f]?e[f]:0);for(c.push(f);d<l;)f=b.crds[d++],c.push(parseFloat(f.toFixed(a))+(d==l?"":" "))}return c.join("")};f.U.pathToContext=function(b,a){for(var c=0,
d=b.crds,e=0;e<b.cmds.length;e++){var g=b.cmds[e];"M"==g?(a.moveTo(d[c],d[c+1]),c+=2):"L"==g?(a.lineTo(d[c],d[c+1]),c+=2):"C"==g?(a.bezierCurveTo(d[c],d[c+1],d[c+2],d[c+3],d[c+4],d[c+5]),c+=6):"Q"==g?(a.quadraticCurveTo(d[c],d[c+1],d[c+2],d[c+3]),c+=4):"#"==g.charAt(0)?(a.beginPath(),a.fillStyle=g):"Z"==g?a.closePath():"X"==g&&a.fill()}};f.U.P={};f.U.P.moveTo=function(b,a,c){b.cmds.push("M");b.crds.push(a,c)};f.U.P.lineTo=function(b,a,c){b.cmds.push("L");b.crds.push(a,c)};f.U.P.curveTo=function(b,
a,c,d,e,g,f){b.cmds.push("C");b.crds.push(a,c,d,e,g,f)};f.U.P.qcurveTo=function(b,a,c,d,e){b.cmds.push("Q");b.crds.push(a,c,d,e)};f.U.P.closePath=function(b){b.cmds.push("Z")};f.U._drawCFF=function(b,a,c,d,e){for(var g=a.stack,h=a.nStems,l=a.haveWidth,n=a.width,k=a.open,t=0,m=a.x,q=a.y,p,r,v,u,z,A,B,E,D,F,y={val:0,size:0};t<b.length;){f.CFF.getCharString(b,t,y);var x=y.val;t+=y.size;if("o1"==x||"o18"==x)(p=0!==g.length%2)&&!l&&(n=g.shift()+d.nominalWidthX),h+=g.length>>1,g.length=0,l=!0;else if("o3"==
x||"o23"==x)(p=0!==g.length%2)&&!l&&(n=g.shift()+d.nominalWidthX),h+=g.length>>1,g.length=0,l=!0;else if("o4"==x)1<g.length&&!l&&(n=g.shift()+d.nominalWidthX,l=!0),k&&f.U.P.closePath(e),q+=g.pop(),f.U.P.moveTo(e,m,q),k=!0;else if("o5"==x)for(;0<g.length;)m+=g.shift(),q+=g.shift(),f.U.P.lineTo(e,m,q);else if("o6"==x||"o7"==x)for(z=g.length,p="o6"==x,r=0;r<z;r++)v=g.shift(),p?m+=v:q+=v,p=!p,f.U.P.lineTo(e,m,q);else if("o8"==x||"o24"==x){z=g.length;for(A=0;A+6<=z;)p=m+g.shift(),r=q+g.shift(),v=p+g.shift(),
u=r+g.shift(),m=v+g.shift(),q=u+g.shift(),f.U.P.curveTo(e,p,r,v,u,m,q),A+=6;"o24"==x&&(m+=g.shift(),q+=g.shift(),f.U.P.lineTo(e,m,q))}else if("o11"==x)break;else if("o1234"==x||"o1235"==x||"o1236"==x||"o1237"==x)"o1234"==x&&(p=m+g.shift(),r=q,v=p+g.shift(),u=r+g.shift(),D=v+g.shift(),F=u,z=D+g.shift(),A=u,B=z+g.shift(),E=q,m=B+g.shift(),f.U.P.curveTo(e,p,r,v,u,D,F),f.U.P.curveTo(e,z,A,B,E,m,q)),"o1235"==x&&(p=m+g.shift(),r=q+g.shift(),v=p+g.shift(),u=r+g.shift(),D=v+g.shift(),F=u+g.shift(),z=D+g.shift(),
A=F+g.shift(),B=z+g.shift(),E=A+g.shift(),m=B+g.shift(),q=E+g.shift(),g.shift(),f.U.P.curveTo(e,p,r,v,u,D,F),f.U.P.curveTo(e,z,A,B,E,m,q)),"o1236"==x&&(p=m+g.shift(),r=q+g.shift(),v=p+g.shift(),u=r+g.shift(),D=v+g.shift(),F=u,z=D+g.shift(),A=u,B=z+g.shift(),E=A+g.shift(),m=B+g.shift(),f.U.P.curveTo(e,p,r,v,u,D,F),f.U.P.curveTo(e,z,A,B,E,m,q)),"o1237"==x&&(p=m+g.shift(),r=q+g.shift(),v=p+g.shift(),u=r+g.shift(),D=v+g.shift(),F=u+g.shift(),z=D+g.shift(),A=F+g.shift(),B=z+g.shift(),E=A+g.shift(),Math.abs(B-
m)>Math.abs(E-q)?m=B+g.shift():q=E+g.shift(),f.U.P.curveTo(e,p,r,v,u,D,F),f.U.P.curveTo(e,z,A,B,E,m,q));else if("o14"==x)0<g.length&&!l&&(n=g.shift()+c.nominalWidthX,l=!0),4==g.length&&(p=g.shift(),r=g.shift(),u=g.shift(),v=g.shift(),u=f.CFF.glyphBySE(c,u),v=f.CFF.glyphBySE(c,v),f.U._drawCFF(c.CharStrings[u],a,c,d,e),a.x=p,a.y=r,f.U._drawCFF(c.CharStrings[v],a,c,d,e)),k&&(f.U.P.closePath(e),k=!1);else if("o19"==x||"o20"==x)(p=0!==g.length%2)&&!l&&(n=g.shift()+d.nominalWidthX),h+=g.length>>1,g.length=
0,l=!0,t+=h+7>>3;else if("o21"==x)2<g.length&&!l&&(n=g.shift()+d.nominalWidthX,l=!0),q+=g.pop(),m+=g.pop(),k&&f.U.P.closePath(e),f.U.P.moveTo(e,m,q),k=!0;else if("o22"==x)1<g.length&&!l&&(n=g.shift()+d.nominalWidthX,l=!0),m+=g.pop(),k&&f.U.P.closePath(e),f.U.P.moveTo(e,m,q),k=!0;else if("o25"==x){for(;6<g.length;)m+=g.shift(),q+=g.shift(),f.U.P.lineTo(e,m,q);p=m+g.shift();r=q+g.shift();v=p+g.shift();u=r+g.shift();m=v+g.shift();q=u+g.shift();f.U.P.curveTo(e,p,r,v,u,m,q)}else if("o26"==x)for(g.length%
2&&(m+=g.shift());0<g.length;)p=m,r=q+g.shift(),v=p+g.shift(),u=r+g.shift(),m=v,q=u+g.shift(),f.U.P.curveTo(e,p,r,v,u,m,q);else if("o27"==x)for(g.length%2&&(q+=g.shift());0<g.length;)p=m+g.shift(),r=q,v=p+g.shift(),u=r+g.shift(),m=v+g.shift(),q=u,f.U.P.curveTo(e,p,r,v,u,m,q);else if("o10"==x||"o29"==x)p="o10"==x?d:c,0==g.length?console.log("error: empty stack"):(r=g.pop(),p=p.Subrs[r+p.Bias],a.x=m,a.y=q,a.nStems=h,a.haveWidth=l,a.width=n,a.open=k,f.U._drawCFF(p,a,c,d,e),m=a.x,q=a.y,h=a.nStems,l=a.haveWidth,
n=a.width,k=a.open);else if("o30"==x||"o31"==x)for(p=g.length,A=0,x="o31"==x,z=p&-3,A+=p-z;A<z;)x?(p=m+g.shift(),r=q,v=p+g.shift(),u=r+g.shift(),q=u+g.shift(),5==z-A?(m=v+g.shift(),A++):m=v,x=!1):(p=m,r=q+g.shift(),v=p+g.shift(),u=r+g.shift(),m=v+g.shift(),5==z-A?(q=u+g.shift(),A++):q=u,x=!0),f.U.P.curveTo(e,p,r,v,u,m,q),A+=4;else{if("o"==(x+"").charAt(0))throw console.log("Unknown operation: "+x,b),x;g.push(x)}}a.x=m;a.y=q;a.nStems=h;a.haveWidth=l;a.width=n;a.open=k};return f},function(){function k(b,
a){function c(){var a=f.getUint16(l);l+=2;return a}function d(){var a=f.getUint32(l);l+=4;return a}function e(a){z.setUint16(A,a);A+=2}function g(a){z.setUint32(A,a);A+=4}var f=new DataView(b),l=0;d();var n=d();d();var k=c();c();d();c();c();d();d();d();d();d();for(var t=0;Math.pow(2,t)<=k;)t++;t--;for(var m=16*Math.pow(2,t),q=16*k-m,p=12,r=[],v=0;v<k;v++)r.push({tag:d(),offset:d(),compLength:d(),origLength:d(),origChecksum:d()}),p+=16;var u=new Uint8Array(12+16*r.length+r.reduce(function(a,b){return a+
b.origLength+4},0));v=u.buffer;var z=new DataView(v),A=0;g(n);e(k);e(m);e(t);e(q);r.forEach(function(a){g(a.tag);g(a.origChecksum);g(p);g(a.origLength);a.outOffset=p;p+=a.origLength;0!=p%4&&(p+=4-p%4)});var B;r.forEach(function(c){var d=b.slice(c.offset,c.offset+c.compLength);if(c.compLength!=c.origLength){var e=new Uint8Array(c.origLength);a(new Uint8Array(d,2),e)}else e=new Uint8Array(d);u.set(e,c.outOffset);p=c.outOffset+c.origLength;d=0;0!=p%4&&(d=4-p%4);u.set((new Uint8Array(d)).buffer,c.outOffset+
c.origLength);B=p+d});return v.slice(0,B)}var f=function(){function b(){this.table=new Uint16Array(16);this.trans=new Uint16Array(288)}function a(a,c){this.source=a;this.bitcount=this.tag=this.sourceIndex=0;this.dest=c;this.destLen=0;this.ltree=new b;this.dtree=new b}function c(a,b,c,d){var e;for(e=0;e<c;++e)a[e]=0;for(e=0;e<30-c;++e)a[e+c]=e/c|0;c=d;for(e=0;30>e;++e)b[e]=c,c+=1<<a[e]}function d(a,b,c,d){var e,g;for(e=0;16>e;++e)a.table[e]=0;for(e=0;e<d;++e)a.table[b[c+e]]++;for(e=g=a.table[0]=0;16>
e;++e)u[e]=g,g+=a.table[e];for(e=0;e<d;++e)b[c+e]&&(a.trans[u[b[c+e]]++]=e)}function e(a,b,c){if(!b)return c;for(;24>a.bitcount;)a.tag|=a.source[a.sourceIndex++]<<a.bitcount,a.bitcount+=8;var d=a.tag&65535>>>16-b;a.tag>>>=b;a.bitcount-=b;return d+c}function g(a,b){for(;24>a.bitcount;)a.tag|=a.source[a.sourceIndex++]<<a.bitcount,a.bitcount+=8;var c=0,d=0,e=0,g=a.tag;do d=2*d+(g&1),g>>>=1,++e,c+=b.table[e],d-=b.table[e];while(0<=d);a.tag=g;a.bitcount-=e;return b.trans[c+d]}function f(a,b,c){for(;;){var d=
g(a,b);if(256===d)return 0;if(256>d)a.dest[a.destLen++]=d;else{var f;d-=257;d=e(a,k[d],t[d]);var h=g(a,c);for(f=h=a.destLen-e(a,m[h],q[h]);f<h+d;++f)a.dest[a.destLen++]=a.dest[f]}}}var l=new b,n=new b,k=new Uint8Array(30),t=new Uint16Array(30),m=new Uint8Array(30),q=new Uint16Array(30),p=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),r=new b,v=new Uint8Array(320),u=new Uint16Array(16);(function(a,b){var c;for(c=0;7>c;++c)a.table[c]=0;a.table[7]=24;a.table[8]=152;a.table[9]=112;for(c=
0;24>c;++c)a.trans[c]=256+c;for(c=0;144>c;++c)a.trans[24+c]=c;for(c=0;8>c;++c)a.trans[168+c]=280+c;for(c=0;112>c;++c)a.trans[176+c]=144+c;for(c=0;5>c;++c)b.table[c]=0;b.table[5]=32;for(c=0;32>c;++c)b.trans[c]=c})(l,n);c(k,t,4,3);c(m,q,2,1);k[28]=0;t[28]=258;return function(b,c){b=new a(b,c);do{c=b;c.bitcount--||(c.tag=c.source[c.sourceIndex++],c.bitcount=7);var h=c.tag&1;c.tag>>>=1;c=h;h=e(b,2,0);switch(h){case 0:for(h=b;8<h.bitcount;)h.sourceIndex--,h.bitcount-=8;var k=h.source[h.sourceIndex+1];
k=256*k+h.source[h.sourceIndex];var m=h.source[h.sourceIndex+3];m=256*m+h.source[h.sourceIndex+2];if(k!==(~m&65535))h=-3;else{h.sourceIndex+=4;for(m=k;m;--m)h.dest[h.destLen++]=h.source[h.sourceIndex++];h=h.bitcount=0}break;case 1:h=f(b,l,n);break;case 2:var q;k=b;var t=b.ltree,w=b.dtree;m=e(k,5,257);h=e(k,5,1);var u=e(k,4,4);for(q=0;19>q;++q)v[q]=0;for(q=0;q<u;++q){var z=e(k,3,0);v[p[q]]=z}d(r,v,0,19);for(q=0;q<m+h;)switch(u=g(k,r),u){case 16:z=v[q-1];for(u=e(k,2,3);u;--u)v[q++]=z;break;case 17:for(u=
e(k,3,3);u;--u)v[q++]=0;break;case 18:for(u=e(k,7,11);u;--u)v[q++]=0;break;default:v[q++]=u}d(t,v,0,m);d(w,v,m,h);h=f(b,b.ltree,b.dtree);break;default:h=-3}if(0!==h)throw Error("Data error");}while(!c);return b.destLen<b.dest.length?"function"===typeof b.dest.slice?b.dest.slice(0,b.destLen):b.dest.subarray(0,b.destLen):b.dest}}();return function(b){return k(b,f)}},function(k,f){function b(b){var c=b[0],e=Object.create(null),g={unitsPerEm:c.head.unitsPerEm,ascender:c.hhea.ascender,descender:c.hhea.descender,
forEachGlyph:function(b,d,f,w){var h=0,l=1/g.unitsPerEm*d,n=0;k.U.stringToGlyphs(c,b).forEach(function(g){if(-1!==g){var m=e[g];if(!m){m=k.glyf._parseGlyf(c,g)||{xMin:0,xMax:0,yMin:0,yMax:0};var p=k.U.glyphToPath(c,g),q=p.cmds,t=p.crds;m=e[g]={index:g,advanceWidth:c.hmtx.aWidth[g],xMin:m.xMin,yMin:m.yMin,xMax:m.xMax,yMax:m.yMax,pathCommandCount:q.length,forEachPathCommand:function(b){for(var c=0,d=[],e=0,g=q.length;e<g;e++){var f=a[q[e]];d.length=1+f;d[0]=q[e];for(var h=1;h<=f;h++)d[h]=t[c++];b.apply(null,
d)}}}}w.call(null,m,h,n);m.advanceWidth&&(h+=m.advanceWidth*l);f&&(h+=f*d)}n+=65535<b.codePointAt(n)?2:1});return h}};return g}var a={M:2,L:2,Q:4,C:6,Z:0};return function(a){var c=new Uint8Array(a,0,4);c=k._bin.readASCII(c,0,4);if("wOFF"===c)a=f(a);else if("wOF2"===c)throw Error("woff2 fonts not supported");return b(k.parse(a))}}],init:function(k,f,b){k=k();f=f();return b(k,f)}}),L={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,textureWidth:2048},
U=document.createElement("a"),V=Object.create(null);M=I.defineWorkerModule({dependencies:[L,.125,M,function(k){function f(a){return a*a}var b=k.sdfTextureSize,a=k.sdfDistancePercent,c=function(a){var b=a.xMin,c=a.yMin,d=a.xMax-b;a=a.yMax-c;this._root={0:null,1:null,2:null,3:null,data:null,cx:Math.round(b+d/2),cy:Math.round(c+a/2),r:Math.pow(2,Math.floor(Math.log(Math.max(d,a))*Math.LOG2E)),minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}};c.prototype.addLineSegment=function(a,b,c,f){this._insertSegment({x0:a,
y0:b,x1:c,y1:f,cx:(a+c)/2,cy:(b+f)/2,minX:Math.min(a,c),minY:Math.min(b,f),maxX:Math.max(a,c),maxY:Math.max(b,f),next:null},this._root)};c.prototype._insertSegment=function(a,b){var c=a.minX,d=a.minY,e=a.maxX,f=a.maxY,k=a.cx,t=a.cy;c<b.minX&&(b.minX=c);d<b.minY&&(b.minY=d);e>b.maxX&&(b.maxX=e);f>b.maxY&&(b.maxY=f);var m=b.data;if(m)if(m.cx===k&&m.cy===t){for(;m.next;)m=m.next;m.next=a}else b.data=null,this._insertSegment(m,b),this._insertSegment(a,b);else k=(t<b.cy?0:2)+(k<b.cx?0:1),b[k]?this._insertSegment(a,
b[k]):b[k]={0:null,1:null,2:null,3:null,data:a,cx:b.cx+b.r/2*(k%2?1:-1),cy:b.cy+b.r/2*(2>k?-1:1),r:b.r/2,minX:c,minY:d,maxX:e,maxY:f}};c.prototype.walkTree=function(a){this.walkBranch(this._root,a)};c.prototype.walkBranch=function(a,b){if(!1!==b(a)&&!a.data)for(var c=0;4>c;c++)null!==a[c]&&this.walkBranch(a[c],b)};c.prototype.findNearestSignedDistance=function(a,b,c){var d=c;this.walkTree(function(c){if(a-d>c.maxX||a+d<c.minX||b-d>c.maxY||b+d<c.minY)return!1;if(c.data)for(c=c.data;c;c=c.next)if(a-
d<c.maxX||a+d>c.minX||b-d<c.maxY||b+d>c.minY){var e=a;var g=b,h=c.x0,l=c.y0,k=c.x1-h,p=c.y1-l,r=k*k+p*p;r=r?Math.max(0,Math.min(1,((e-h)*k+(g-l)*p)/r)):0;e=Math.sqrt(f(e-(h+r*k))+f(g-(l+r*p)));e<d&&(d=e)}});this.isPointInPoly(a,b)||(d=-d);return d};c.prototype.isPointInPoly=function(a,b){var c=!1;this.walkTree(function(d){if(d.maxX<a||d.minY>b||d.maxY<b)return!1;if(d.data)for(d=d.data;d;d=d.next){var e=d.x0,g=d.y0,f=d.x1,h=d.y1;g>b!==h>b&&a<(f-e)*(b-g)/(h-g)+e&&(c=!c)}});return c};return function(d){var e=
new Uint8Array(b*b),g=d.xMax-d.xMin,f=d.yMax-d.yMin,l=Math.max(g,f)*a,k=(g+2*l)/b,w=(f+2*l)/b;f=d.xMin-l-k;g=d.yMin-l-w;k=d.xMax+l+k;w=d.yMax+l+w;if(d.pathCommandCount){var t=new c(d),m,q,p,r;d.forEachPathCommand(function(a,b,c,d,e,g,f){switch(a){case "M":p=m=b;r=q=c;break;case "L":b===p&&c===r||t.addLineSegment(p,r,p=b,r=c);break;case "Q":g={x:p,y:r};for(f=1;16>f;f++){a=f/15;var h=1-a;a={x:h*h*p+2*h*a*b+a*a*d,y:h*h*r+2*h*a*c+a*a*e};t.addLineSegment(g.x,g.y,a.x,a.y);g=a}p=d;r=e;break;case "C":a={x:p,
y:r};for(h=1;16>h;h++){var l=h/15;var k=1-l;l={x:k*k*k*p+3*k*k*l*b+3*k*l*l*d+l*l*l*g,y:k*k*k*r+3*k*k*l*c+3*k*l*l*e+l*l*l*f};t.addLineSegment(a.x,a.y,l.x,l.y);a=l}p=g;r=f;break;case "Z":p===m&&r===q||t.addLineSegment(p,r,m,q)}});for(d=0;d<b;d++)for(var v=0;v<b;v++){var u=t.findNearestSignedDistance(f+(k-f)*(d+.5)/b,g+(w-g)*(v+.5)/b,l);u=isFinite(u)?Math.round(127.5*(1+u/l)):u;u=Math.max(0,Math.min(255,u));e[v*b+d]=u}}return{textureData:e,renderingBounds:[f,g,k,w]}}},function(k,f,b){function a(a,b){function c(){var d=
function(b){console.error("Failure loading font "+a+(a===g?"":"; trying fallback"),b);a!==g&&(a=g,c())};try{var e=new XMLHttpRequest;e.open("get",a,!0);e.responseType="arraybuffer";e.onload=function(){if(400<=e.status)d(Error(e.statusText));else if(0<e.status)try{var a=k(e.response);b(a)}catch(p){d(p)}};e.onerror=d;e.send()}catch(q){d(q)}}c()}function c(b,c){b||(b=g);var d=h[b];if(d)d.onload?d.onload.push(c):c();else{var e=h[b]={onload:[c]};a(b,function(a){d=h[b]={fontObj:a,glyphs:{},glyphCount:0};
e.onload.forEach(function(a){return a()})})}}function d(a,b){a||(a=g);c(a,function(){b(h[a])})}function e(a,b,c){var e=a.text;void 0===e&&(e="");var h=a.font;void 0===h&&(h=g);var k=a.fontSize;void 0===k&&(k=1);var l=a.letterSpacing;void 0===l&&(l=0);var n=a.lineHeight;void 0===n&&(n="normal");var v=a.maxWidth;void 0===v&&(v=Infinity);var u=a.textAlign;void 0===u&&(u="left");var w=a.whiteSpace;void 0===w&&(w="normal");var y=a.overflowWrap;void 0===y&&(y="normal");var B=a.anchor,E=a.includeCaretPositions;
void 0===E&&(E=!1);void 0===c&&(c=!1);-1<e.indexOf("\r")&&(console.warn("FontProcessor.process: got text with \\r chars; normalizing to \\n"),e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n"));d(h,function(a){var d=a.fontObj,g=isFinite(v),h=null,m=null,p=null,q=null,r=null,t=0,z="nowrap"!==w,A=d.ascender,C=d.descender,D=d.unitsPerEm,J=k/D;"normal"===n&&(n=(A-C)/D);n*=k;var I=(n-(A-C)*J)/2;D=Math.min(n,(A-C)*J);var L=(A+C)/2*J-D/2,N=0,K={glyphs:[],width:0},O=[K];d.forEachGlyph(e,k,l,function(a,b,c){var d=
e.charAt(c),f=a.advanceWidth*J,h=!!d&&/\s/.test(d),k=K.glyphs;if(z&&g&&!h&&b+f+N>v&&k.length){if(k[k.length-1].isWhitespace){var l=[];N=-b}else for(var n=k.length;n--;)if(0===n&&"break-word"===y){l=[];N=-b;break}else if(k[n].isWhitespace){l=k.splice(n+1);k=l[0].x;N-=k;for(n=0;n<l.length;n++)l[n].x-=k;break}l&&(K.isSoftWrapped=!0,K={glyphs:l,width:0},O.push(K),t=v)}K.glyphs.push({glyphObj:a,x:b+N,y:0,width:f,char:d,charIndex:c,isWhitespace:h,isEmpty:a.xMin===a.xMax||a.yMin===a.yMax,atlasInfo:null});
"\n"===d&&(K={glyphs:[],width:0},O.push(K),N=-(b+f))});O.forEach(function(a){for(var b=a.glyphs,c=b.length;c--;){var d=b[c];if(!d.isWhitespace){a.width=d.x+d.width;a.width>t&&(t=a.width);break}}});if(!c){var G=[],M=-(k+I);E&&(q=new Float32Array(3*e.length));var H=-1;O.forEach(function(b){var c=b.glyphs,d=b.width;if(c.length){var e=0,g=0;if("center"===u)e=(t-d)/2;else if("right"===u)e=t-d;else if("justify"===u)for(var k=c.length;k--;)if(!c[k].isWhitespace){for(;k--;)c[k].isWhitespace&&g++;break}k=
0;for(var l=c.length;k<l;k++){var m=c[k];e&&(m.x+=e);m.y=M;if(m.isWhitespace&&"justify"===u&&b.isSoftWrapped){var p=(t-d)/g;e+=p;m.width+=p}if(E){p=m.charIndex;q[3*p]=m.x;q[3*p+1]=m.x+m.width;for(q[3*p+2]=m.y+L;1<p-H;)q[3*(H+1)]=q[3*H+1],q[3*(H+1)+1]=q[3*H+1],q[3*(H+1)+2]=q[3*H+2],H++;H=p}if(!m.isWhitespace&&!m.isEmpty){p=m.glyphObj;var r=a.glyphs[p.index];r||(r=f(p),r.atlasIndex=a.glyphCount++,h||(h=[]),h.push(r),r=a.glyphs[p.index]={atlasIndex:r.atlasIndex,glyphObj:p,renderingBounds:r.renderingBounds});
m.atlasInfo=r;G.push(m)}}}M-=n});var P=0,Q=0;B&&(B[0]&&(P=-t*B[0]),B[1]&&(Q=O.length*n*B[1]));if(E&&(P||Q))for(d=0,A=q.length;d<A;d+=3)q[d]+=P,q[d+1]+=P,q[d+2]+=Q;m=new Float32Array(4*G.length);p=new Float32Array(G.length);r=[Infinity,Infinity,-Infinity,-Infinity];G.forEach(function(a,b){var c=a.atlasInfo,d=c.renderingBounds;c=c.atlasIndex;var e=m[4*b]=a.x+d[0]*J+P,g=m[4*b+1]=a.y+d[1]*J+Q,f=m[4*b+2]=a.x+d[2]*J+P;a=m[4*b+3]=a.y+d[3]*J+Q;e<r[0]&&(r[0]=e);g<r[1]&&(r[1]=g);f>r[2]&&(r[2]=f);a>r[3]&&(r[3]=
a);p[b]=c})}b({glyphBounds:m,glyphAtlasIndices:p,caretPositions:q,caretHeight:D,totalBounds:r,totalBlockSize:[t,O.length*n],newGlyphSDFs:h})})}var g=b.defaultFontUrl,h=Object.create(null);return{process:e,measure:function(a,b){e(a,function(a){b({width:a.totalBlockSize[0],height:a.totalBlockSize[1]})},{metricsOnly:!0})},loadFont:c}}],init:function(k,f,b,a,c){f=a({sdfTextureSize:k.sdfGlyphSize,sdfDistancePercent:f});return c(b,f,{defaultFontUrl:k.defaultFontURL})}});var ia=I.defineWorkerModule({dependencies:[M,
I.ThenableWorkerModule],init:function(k,f){return function(b){var a=new f;k.process(b,a.resolve);return a}},getTransferables:function(k){var f=[k.glyphBounds.buffer,k.glyphAtlasIndices.buffer];k.caretPositions&&f.push(k.caretPositions.buffer);k.newGlyphSDFs&&k.newGlyphSDFs.forEach(function(b){f.push(b.textureData.buffer)});return f}}),ma=(new y.PlaneBufferGeometry(1,1)).translate(.5,.5,0),na=new y.Vector3,R=function(k){function f(){k.call(this);this.copy(ma);this.boundingSphere=new y.Sphere}k&&(f.__proto__=
k);f.prototype=Object.create(k&&k.prototype);f.prototype.constructor=f;f.prototype.computeBoundingSphere=function(){};f.prototype.updateGlyphs=function(b,a,c){W(this,"aTroikaGlyphBounds",b,4);W(this,"aTroikaGlyphIndex",a,1);this.maxInstancedCount=a.length;b=this.boundingSphere;b.center.set((c[0]+c[2])/2,(c[1]+c[3])/2,0);b.radius=b.center.distanceTo(na.set(c[0],c[1],0))};return f}(y.InstancedBufferGeometry);R.prototype.setAttribute||(R.prototype.setAttribute=function(k,f){this.attributes[k]=f;return this});
var ca=new y.MeshBasicMaterial({color:16777215,side:y.DoubleSide,transparent:!0}),oa=new y.Matrix4,da=new y.Mesh((new y.PlaneBufferGeometry(1,1)).translate(.5,.5,0),ca),S=function(k){function f(a){a=new R;k.call(this,a,null);this.text="";this.font=this.anchor=null;this.fontSize=.1;this.letterSpacing=0;this.lineHeight="normal";this.maxWidth=Infinity;this.overflowWrap="normal";this.textAlign="left";this.whiteSpace="normal";this.color=this.material=null;this.depthOffset=0;this.clipRect=null;this.debugSDF=
!1}k&&(f.__proto__=k);f.prototype=Object.create(k&&k.prototype);f.prototype.constructor=f;var b={textRenderInfo:{configurable:!0},material:{configurable:!0},customDepthMaterial:{configurable:!0},customDistanceMaterial:{configurable:!0}};f.prototype.sync=function(a){var b=this;this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(a):(this._isSyncing=!0,ha({text:this.text,font:this.font,fontSize:this.fontSize,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,
maxWidth:this.maxWidth,textAlign:this.textAlign,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchor:this.anchor,includeCaretPositions:!0},function(c){b._isSyncing=!1;b._textRenderInfo=c;b.geometry.updateGlyphs(c.glyphBounds,c.glyphAtlasIndices,c.totalBounds);var d=b._queuedSyncs;d&&(b._queuedSyncs=null,b._needsSync=!0,b.sync(function(){d.forEach(function(a){return a&&a()})}));a&&a()})))};f.prototype.onBeforeRender=function(){this.sync();this._prepareMaterial()};f.prototype.dispose=function(){this.geometry.dispose()};
b.textRenderInfo.get=function(){return this._textRenderInfo||null};b.material.get=function(){var a=this._derivedMaterial,b=this._baseMaterial||ca;a&&a.baseMaterial===b||(a&&a.dispose(),a=this._derivedMaterial=ja(b),b.addEventListener("dispose",function e(){b.removeEventListener("dispose",e);a.dispose()}));return a};b.material.set=function(a){this._baseMaterial=a};b.customDepthMaterial.get=function(){return this._updateLayoutUniforms(this.material.getDepthMaterial())};b.customDistanceMaterial.get=
function(){return this._updateLayoutUniforms(this.material.getDistanceMaterial())};f.prototype._prepareMaterial=function(){var a=this._derivedMaterial;this._updateLayoutUniforms(a);a.uniforms.uTroikaSDFDebug.value=!!this.debugSDF;a.polygonOffset=!!this.depthOffset;a.polygonOffsetFactor=a.polygonOffsetUnits=this.depthOffset||0;var b=this.color;null!=b&&a.color&&a.color.isColor&&b!==a._troikaColor&&a.color.set(a._troikaColor=b)};f.prototype._updateLayoutUniforms=function(a){var b=this.textRenderInfo,
d=a.uniforms;if(b){var e=b.sdfTexture,g=b.totalBounds;d.uTroikaSDFTexture.value=e;d.uTroikaSDFTextureSize.value.set(e.image.width,e.image.height);d.uTroikaSDFGlyphSize.value=b.sdfGlyphSize;d.uTroikaSDFMinDistancePct.value=b.sdfMinDistancePercent;d.uTroikaTotalBounds.value.fromArray(g);(b=this.clipRect)&&Array.isArray(b)&&4===b.length?d.uTroikaClipRect.value.set(Math.max(g[0],b[0]),Math.max(g[1],b[1]),Math.min(g[2],b[2]),Math.min(g[3],b[3])):d.uTroikaClipRect.value.fromArray(g)}return a};f.prototype.raycast=
function(a,b){var c=this.textRenderInfo;c&&(c=c.totalBounds,da.matrixWorld.multiplyMatrices(this.matrixWorld,oa.set(c[2]-c[0],0,0,c[0],0,c[3]-c[1],0,c[1],0,0,1,0,0,0,0,1)),da.raycast(a,b))};Object.defineProperties(f.prototype,b);return f}(y.Mesh);"font fontSize letterSpacing lineHeight maxWidth overflowWrap text textAlign whiteSpace anchor".split(" ").forEach(function(k){var f="_private_"+k;Object.defineProperty(S.prototype,k,{get:function(){return this[f]},set:"anchor"===k?function(b){JSON.stringify(b)!==
JSON.stringify(this[f])&&(this[f]=b,this._needsSync=!0)}:function(b){b!==this[f]&&(this[f]=b,this._needsSync=!0)}})});var Y=new WeakMap,Z=new WeakMap,pa=function(k){function f(b){k.call(this,b,new y.Mesh(aa(),ba().clone()))}k&&(f.__proto__=k);f.prototype=Object.create(k&&k.prototype);f.prototype.constructor=f;f.prototype.afterUpdate=function(){var b=this.top,a=this.right,c=this.bottom,d=this.left,e=this.color;e!==this._color&&this.threeObject.material.color.set(this._color=e);this.threeObject.material.uniforms.rect.value.set(d,
b,a,c);k.prototype.afterUpdate.call(this)};return f}(G.Object3DFacade),ea=new y.Matrix4,qa=new y.Plane,ra=new y.Vector3,sa=function(k){function f(b,a){var c=this;k.call(this,b);var d=b.threeObject;this.rangeColor=52479;var e=function(e){var h=c.textRenderInfo;h&&(e=e.intersection.point.clone().applyMatrix4(ea.getInverse(d.matrixWorld)),h=X(h,e.x,e.y))&&(a(h.charIndex,h.charIndex),b.addEventListener("drag",g),b.addEventListener("dragend",f))},g=function(b){var e=d.textRenderInfo;b.ray&&e&&(b=b.ray.clone().applyMatrix4(ea.getInverse(d.matrixWorld)).intersectPlane(qa.setComponents(0,
0,1,0),ra))&&(e=X(e,b.x,b.y))&&a(c.selectionStart,e.charIndex)},f=function(a){b.removeEventListener("drag",g);b.removeEventListener("dragend",f)};b.addEventListener("dragstart",e);b.addEventListener("mousedown",e);this._cleanupEvents=function(){f();b.removeEventListener("dragstart",e);b.removeEventListener("mousedown",e)}}k&&(f.__proto__=k);f.prototype=Object.create(k&&k.prototype);f.prototype.constructor=f;f.prototype.afterUpdate=function(){var b=this,a=la(this.textRenderInfo,this.selectionStart,
this.selectionEnd);this.children=a?a.map(function(a,d){var c=a.top,g=a.bottom;return{key:"rect"+d,facade:pa,top:c,right:a.right,bottom:g,left:a.left,z:.25*(c-g)/2,scaleZ:.25*(c-g),color:b.rangeColor,renderOrder:b.renderOrder||0}}):null;k.prototype.afterUpdate.call(this)};f.prototype.destructor=function(){this._cleanupEvents();k.prototype.destructor.call(this)};return f}(G.Group3DFacade),ta="text anchor font fontSize letterSpacing lineHeight maxWidth overflowWrap textAlign whiteSpace material color depthOffset clipRect debugSDF".split(" ");
I=function(k){function f(b){var a=this,c=new S;c.geometry.boundingSphere.version=0;k.call(this,b,c);this.selectable=!1;this.selectionStart=this.selectionEnd=-1;this._afterSync=function(){a.isDestroying||(c.geometry.boundingSphere.version++,a.afterUpdate(),a.notifyWorld("needsRender"))}}k&&(f.__proto__=k);f.prototype=Object.create(k&&k.prototype);f.prototype.constructor=f;f.prototype.afterUpdate=function(){var b=this,a=this.threeObject;ta.forEach(function(c){a[c]=b[c]});a.sync(this._afterSync);k.prototype.afterUpdate.call(this);
this.text!==this._prevText&&(this.selectionStart=this.selectionEnd=-1,this._prevText=this.text);this._updateSelection()};f.prototype._updateSelection=function(){var b=this,a=this.selectable,c=this.selectionStart,d=this.selectionEnd,e=this._selectionFacade;a!==this._selectable&&((this._selectable=a)?e=this._selectionFacade=new sa(this,function(a,c){b.selectionStart=a;b.selectionEnd=c;b._updateSelection();b.notifyWorld("needsRender")}):(e&&(e.destructor(),e=this._selectionFacade=null),this.selectionStart=
this.selectionEnd=-1));e&&(e.textRenderInfo=this.threeObject.textRenderInfo,e.selectionStart=c,e.selectionEnd=d,e.renderOrder=this.renderOrder,e.afterUpdate())};f.prototype.destructor=function(){this.threeObject.dispose();this._selectionFacade&&this._selectionFacade.destructor();k.prototype.destructor.call(this)};return f}(G.Object3DFacade);C.GlyphsGeometry=R;C.Text3DFacade=I;C.TextMesh=S;C.configureTextBuilder=function(k){T(L,k)};C.fontProcessorWorkerModule=M;Object.defineProperty(C,"__esModule",
{value:!0})});
